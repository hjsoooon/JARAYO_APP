// ë™í™” ì¼ê¸° ìƒì„± ì„œë¹„ìŠ¤

// ê°ì„±ì ì¸ ì œëª© ìƒì„± í•¨ìˆ˜
const generateStoryTitle = (name: string, userInput: string, phrContext: string): string => {
  const lowerInput = userInput.toLowerCase();
  
  // í‚¤ì›Œë“œ ê¸°ë°˜ ê°ì„± ì œëª© ìƒì„±
  const titleTemplates = [
    // ê°€ì¡± ê´€ë ¨
    { keywords: ['ì•„ë¹ ', 'ì•„ë²„ì§€', 'papa'], titles: ['ì•„ë¹ ì˜ í’ˆì€ ìµœê³ ì•¼', 'ì•„ë¹ ë‘ í•¨ê»˜í•œ íŠ¹ë³„í•œ ì‹œê°„', 'ì•„ë¹  ë¹„í–‰ê¸° íƒ‘ìŠ¹ ì™„ë£Œ!', 'ì•„ë¹  ì–´ê¹¨ëŠ” ë†€ì´í„°', 'ì•„ë¹  í’ˆì— í­ ì•ˆê¸°ê¸°'] },
    { keywords: ['ì—„ë§ˆ', 'ì–´ë¨¸ë‹ˆ', 'mama'], titles: ['ì—„ë§ˆ í’ˆì—ì„œ ê¿ˆê¾¸ê¸°', 'ì—„ë§ˆì˜ ë§ˆë²• ê°™ì€ ì†ê¸¸', 'ì—„ë§ˆ ì‚¬ë‘ì´ ê°€ë“í•œ í•˜ë£¨', 'ì—„ë§ˆ ëª©ì†Œë¦¬ëŠ” ìì¥ê°€', 'ì—„ë§ˆ ëƒ„ìƒˆê°€ ì¢‹ì•„'] },
    { keywords: ['í• ë¨¸ë‹ˆ', 'í• ë¨¸ë‹ˆëŒ'], titles: ['í• ë¨¸ë‹ˆ í’ˆì€ ì†œì‚¬íƒ•', 'í• ë¨¸ë‹ˆì˜ ë”°ëœ»í•œ ì´ì•¼ê¸°', 'í• ë¨¸ë‹ˆë‘ ë³´ë‚¸ ë‹¬ì½¤í•œ ì‹œê°„', 'í• ë¨¸ë‹ˆ ì†ì€ ë§ˆë²• ì†', 'í• ë¨¸ë‹ˆë„¤ ë†€ëŸ¬ê°€ê¸°'] },
    { keywords: ['í• ì•„ë²„ì§€', 'í• ì•„ë²„ì§€ëŒ'], titles: ['í• ì•„ë²„ì§€ì˜ ë„“ì€ í’ˆ', 'í• ì•„ë²„ì§€ì™€ì˜ íŠ¹ë³„í•œ ì¶”ì–µ', 'í• ì•„ë²„ì§€ ë¬´ë¦ì€ ìµœê³ !', 'í• ì•„ë²„ì§€ ì†ì— ì™', 'í• ì•„ë²„ì§€ì™€ í•¨ê»˜í•œ ì‹œê°„'] },
    { keywords: ['í˜•', 'ì˜¤ë¹ ', 'ì–¸ë‹ˆ', 'ëˆ„ë‚˜'], titles: ['í° ì•„ì´ì™€ ì‘ì€ ì•„ì´', 'í˜•ì•„ì™€ì˜ ì‹ ë‚˜ëŠ” ì‹œê°„', 'ì–¸ë‹ˆê°€ ìµœê³ ì•¼', 'ì˜¤ë¹ ë‘ ë†€ê¸°'] },
    
    // í™œë™ ê´€ë ¨
    { keywords: ['ë†€ì´í„°', 'ê³µì›'], titles: ['ì‹ ë‚˜ëŠ” ë†€ì´í„° ëª¨í—˜', 'í•˜ëŠ˜ ì•„ë˜ ìš°ë¦¬ì˜ ë†€ì´', 'ê³µì›ì—ì„œ ë§Œë‚œ í–‰ë³µ', 'ì´ˆë¡ë¹› ë†€ì´í„°ì—ì„œ', 'ë°”ê¹¥ ë‚˜ë“¤ì´ ëŒ€ì„±ê³µ'] },
    { keywords: ['ì‚°ì±…', 'ê±·', 'ì™¸ì¶œ'], titles: ['ë°”ëŒê³¼ í•¨ê»˜ ì‚°ì±…', 'ì‘ì€ ë°œê±¸ìŒì˜ ëª¨í—˜', 'í–‡ì‚´ ë”°ë¼ ê±¸ì–´ìš”', 'ì„¸ìƒ êµ¬ê²½ ë‚˜ë“¤ì´', 'ë°”ê¹¥ ê³µê¸°ëŠ” ìƒì¾Œí•´'] },
    { keywords: ['ëª©ìš•', 'bath', 'ì”»'], titles: ['ê±°í’ˆ ì™•êµ­ì˜ ì™•ìë‹˜', 'ì²¨ë²™ì²¨ë²™ ë¬¼ë†€ì´ ì‹œê°„', 'ë½€ì†¡ë½€ì†¡ ëª©ìš• íƒ€ì„', 'ë¬¼ë°©ìš¸ ì¹œêµ¬ë“¤ê³¼ ë†€ê¸°', 'ê¹¨ë—í•´ì§„ ìš°ë¦¬ ì•„ê¸°'] },
    { keywords: ['ì ', 'ìˆ˜ë©´', 'ë‚®ì ', 'ì'], titles: ['ê¿ˆë‚˜ë¼ë¡œì˜ ì—¬í–‰', 'êµ¬ë¦„ ì¹¨ëŒ€ì—ì„œ ê¿ˆê¾¸ê¸°', 'ìƒˆê·¼ìƒˆê·¼ ë‹¬ì½¤í•œ íœ´ì‹', 'ë³„ë¹› ìì¥ê°€', 'í¬ê·¼í•œ ë‚®ì  ì‹œê°„'] },
    { keywords: ['ë¨¹', 'ì‹ì‚¬', 'ë°¥', 'ìˆ˜ìœ ', 'ë¶„ìœ ', 'ì´ìœ ì‹'], titles: ['ëƒ ëƒ  ë§›ìˆëŠ” íƒí—˜', 'ì‘ì€ ë¯¸ì‹ê°€ì˜ í•œ ë¼', 'ì˜¤ëŠ˜ì˜ ë§›ìˆëŠ” ë°œê²¬', 'ìª½ìª½ìª½ ìš°ìœ  ì‹œê°„', 'ë§›ìˆê²Œ ë¨¹ëŠ” ì²œì‚¬'] },
    { keywords: ['ì¥ë‚œê°', 'ë†€ì´', 'ë¸”ë¡'], titles: ['ì¥ë‚œê° ë‚˜ë¼ì˜ ì™•ì', 'ì‹ ë‚˜ëŠ” ë†€ì´ ì‹œê°„', 'ë¸”ë¡ ìŒ“ê¸° ëŒ€ì‘ì „', 'ì¥ë‚œê°ê³¼ì˜ ëª¨í—˜'] },
    
    // ê°ì • ê´€ë ¨
    { keywords: ['ì›ƒ', 'í–‰ë³µ', 'ì¦ê±°', 'ê¸°ì¨'], titles: ['ì›ƒìŒê½ƒì´ í™œì§ í•€ ë‚ ', 'í–‰ë³µì´ ê°€ë“í•œ í•˜ë£¨', 'ì¦ê±°ì›€ì´ ë„˜ì¹˜ëŠ” ìˆœê°„', 'ë°©ê¸‹ë°©ê¸‹ ë¯¸ì†Œ ì²œì‚¬', 'ê¹Œë¥´ë¥´ ì›ƒìŒ ì†Œë¦¬'] },
    { keywords: ['ìš¸', 'ë³´ì±„', 'ì¹­ì–¼'], titles: ['ëˆˆë¬¼ë„ ì†Œì¤‘í•œ í‘œí˜„', 'ë§ˆìŒì„ ì „í•˜ëŠ” ì‹œê°„', 'ì‘ì€ ë§ˆìŒì˜ ëª©ì†Œë¦¬', 'ìš°ë¦¬ ì•„ê¸°ì˜ ì‹ í˜¸ë“±'] },
    { keywords: ['ì²˜ìŒ', 'ì²«'], titles: ['ì²« ê²½í—˜ì˜ ì„¤ë ˜', 'ìƒˆë¡œìš´ ì„¸ìƒê³¼ì˜ ë§Œë‚¨', 'ì²˜ìŒ ë§ì´í•œ íŠ¹ë³„í•œ ìˆœê°„', 'ì²«ê±¸ìŒì„ í–¥í•´'] },
    { keywords: ['ì„±ì¥', 'ìë¼'], titles: ['ì‘¥ì‘¥ ìë¼ëŠ” ì•„ê¸°', 'ë§¤ì¼ ë‹¬ë¼ì§€ëŠ” ê¸°ì ', 'ì˜¤ëŠ˜ë„ í•œ ë¼˜ ë”'] },
    
    // ë‚ ì”¨/ê³„ì ˆ
    { keywords: ['ë¹„', 'ë¹—ë°©ìš¸', 'ì¥ë§ˆ'], titles: ['ë¹—ë°©ìš¸ ì†Œë¦¬ì™€ í•¨ê»˜', 'ì°½ë°–ì˜ ë¹—ì†Œë¦¬ ìì¥ê°€', 'ë¹„ ì˜¤ëŠ” ë‚ ì˜ í¬ê·¼í•¨', 'ë¹—ì†Œë¦¬ ë“£ê¸°'] },
    { keywords: ['ëˆˆ', 'ê²¨ìš¸', 'ì¶”ìš´'], titles: ['í•˜ì–€ ëˆˆì²˜ëŸ¼ ìˆœìˆ˜í•œ ë‚ ', 'ê²¨ìš¸ í–‡ì‚´ ì•„ë˜ì—ì„œ', 'í¬ê·¼í•œ ê²¨ìš¸ ì´ì•¼ê¸°', 'ëˆˆ ë‚´ë¦¬ëŠ” ë‚ '] },
    { keywords: ['ë´„', 'ê½ƒ', 'ë”°ëœ»'], titles: ['ë´„ê½ƒì²˜ëŸ¼ í”¼ì–´ë‚˜ëŠ” ë¯¸ì†Œ', 'ë´„ë°”ëŒê³¼ í•¨ê»˜ ì¶¤ì„', 'ê½ƒí–¥ê¸° ê°€ë“í•œ í•˜ë£¨', 'ë”°ìŠ¤í•œ ë´„ë‚ ì˜ ì„ ë¬¼'] },
    { keywords: ['ì—¬ë¦„', 'ë”ìš´'], titles: ['ì—¬ë¦„ í–‡ì‚´ ì•„ë˜', 'ì‹œì›í•œ ë°”ëŒ ì°¾ê¸°', 'ì—¬ë¦„ë‚ ì˜ ì‘ì€ íœ´ì‹'] },
    { keywords: ['ê°€ì„', 'ì„ ì„ '], titles: ['ê°€ì„ í•˜ëŠ˜ ì•„ë˜', 'ë‚™ì—½ì²˜ëŸ¼ ë¶€ë“œëŸ¬ìš´ ë‚ ', 'ê°€ì„ ë°”ëŒì˜ ë…¸ë˜'] },
  ];
  
  // ì…ë ¥ì—ì„œ í‚¤ì›Œë“œ ì°¾ê¸°
  for (const template of titleTemplates) {
    for (const keyword of template.keywords) {
      if (lowerInput.includes(keyword)) {
        return template.titles[Math.floor(Math.random() * template.titles.length)];
      }
    }
  }
  
  // PHR ê¸°ë°˜ ì œëª©
  if (phrContext.includes('SLEEP')) {
    const sleepTitles = ['ê¿ˆë‚˜ë¼ ì—¬í–‰', 'í¬ê·¼í•œ ì ì˜ ë‚˜ë¼', 'ë³„ë¹› ì•„ë˜ ì ë“  ì²œì‚¬'];
    return sleepTitles[Math.floor(Math.random() * sleepTitles.length)];
  }
  if (phrContext.includes('FEED')) {
    const feedTitles = ['ì˜¤ëŠ˜ì˜ ë§›ìˆëŠ” ì‹ì‚¬', 'ëƒ ëƒ  í–‰ë³µí•œ ì‹œê°„', 'ì‘ì€ ì…ìœ¼ë¡œ í° í–‰ë³µ'];
    return feedTitles[Math.floor(Math.random() * feedTitles.length)];
  }
  if (phrContext.includes('BATH')) {
    const bathTitles = ['ë¬¼ë°©ìš¸ ì¹œêµ¬ë“¤ê³¼ ë†€ê¸°', 'ê±°í’ˆ ëª©ìš• íŒŒí‹°', 'ë½€ë“ë½€ë“ ê¹¨ë—ì´'];
    return bathTitles[Math.floor(Math.random() * bathTitles.length)];
  }
  
  // ê¸°ë³¸ ê°ì„± ì œëª©ë“¤
  const defaultTitles = [
    `${name}ì˜ ì†Œì¤‘í•œ í•˜ë£¨`,
    `${name}ê°€ ë¹›ë‚˜ëŠ” ìˆœê°„`,
    `ë”°ëœ»í•œ ì‚¬ë‘ì´ ê°€ë“í•œ ë‚ `,
    `ì‘ì€ ê¸°ì  ê°™ì€ í•˜ë£¨`,
    `${name}ì™€ í•¨ê»˜í•œ íŠ¹ë³„í•œ ì‹œê°„`,
    `ì˜¤ëŠ˜ë„ í–‰ë³µí•œ ìš°ë¦¬`,
    `ì‚¬ë‘ìœ¼ë¡œ ê°€ë“ ì±„ìš´ í•˜ë£¨`,
    `${name}ì˜ ì‘ì€ ëª¨í—˜`,
    `ë³„ì²˜ëŸ¼ ë°˜ì§ì´ëŠ” ${name}`,
    `${name}ì˜ í–‰ë³µ ë ˆì‹œí”¼`,
    `ì˜¤ëŠ˜ë„ ì‚¬ë‘ìŠ¤ëŸ¬ìš´ ${name}`,
    `${name}ì™€ ë³´ë‚¸ í™©ê¸ˆ ê°™ì€ ì‹œê°„`,
    `ì‘ì€ ì²œì‚¬ ${name}ì˜ í•˜ë£¨`,
    `${name}ì˜ ë§ˆë²• ê°™ì€ ìˆœê°„`,
    `í–‡ì‚´ ê°™ì€ ${name}`,
    `êµ¬ë¦„ ìœ„ë¥¼ ê±·ëŠ” ê¸°ë¶„`,
    `ì„¸ìƒì—ì„œ ê°€ì¥ ì˜ˆìœ ë‚ `,
    `${name}ì˜ ë‹¬ì½¤í•œ ì¼ìƒ`,
    `ë¬´ì§€ê°œë¹› í•˜ë£¨`,
    `ì‘ì€ ì†ìœ¼ë¡œ ê¿ˆê¾¸ê¸°`,
  ];
  
  return defaultTitles[Math.floor(Math.random() * defaultTitles.length)];
};

// ë™í™”ì˜ ì‹œì‘ ë¬¸ì¥ í…œí”Œë¦¿
const storyBeginnings = [
  (name: string) => `ì˜¤ëŠ˜ë„ ì‘ì€ ì„¸ê³„ì˜ ì£¼ì¸ê³µ ${name}ì˜ í•˜ë£¨ê°€ ì‹œì‘ë˜ì—ˆì–´ìš”.`,
  (name: string) => `í–‡ì‚´ì´ ì°½ë¬¸ ë„ˆë¨¸ë¡œ ì‚´ë©°ì‹œ ë“¤ì–´ì˜¤ë˜ ì•„ì¹¨, ${name}ì˜ íŠ¹ë³„í•œ í•˜ë£¨ê°€ í¼ì³ì¡Œë‹µë‹ˆë‹¤.`,
  (name: string) => `êµ¬ë¦„ ë‚˜ë¼ì—ì„œ ì˜¨ ì‘ì€ ì²œì‚¬ ${name}! ì˜¤ëŠ˜ì€ ì–´ë–¤ ëª¨í—˜ì„ í–ˆì„ê¹Œìš”?`,
  (name: string) => `ë°˜ì§ë°˜ì§ ë¹›ë‚˜ëŠ” ë³„ì²˜ëŸ¼ ì˜ˆìœ ìš°ë¦¬ ${name}ì˜ í•˜ë£¨ ì´ì•¼ê¸°ë¥¼ ë“¤ë ¤ë“œë¦´ê²Œìš”.`,
  (name: string) => `ì‘ì€ ì™•ìë‹˜ ${name}, ì˜¤ëŠ˜ë„ ì—„ë§ˆ ì•„ë¹ ì™€ í•¨ê»˜ ì¦ê±°ìš´ ì‹œê°„ì„ ë³´ëƒˆì–´ìš”.`,
];

// ë™í™”ì˜ ë§ˆë¬´ë¦¬ ë¬¸ì¥ í…œí”Œë¦¿
const storyEndings = [
  (name: string) => `\n\nê·¸ë ‡ê²Œ ${name}ì˜ ì˜¤ëŠ˜ í•˜ë£¨ë„ ë”°ëœ»í•œ ì‚¬ë‘ìœ¼ë¡œ ê°€ë“ ì±„ì›Œì¡Œë‹µë‹ˆë‹¤. ë‚´ì¼ì€ ë˜ ì–´ë–¤ í–‰ë³µí•œ ìˆœê°„ë“¤ì´ ê¸°ë‹¤ë¦¬ê³  ìˆì„ê¹Œìš”? ğŸ’«`,
  (name: string) => `\n\nì—„ë§ˆ ì•„ë¹ ì˜ í’ˆì—ì„œ ${name}ëŠ” ì˜¤ëŠ˜ë„ ì„¸ìƒì—ì„œ ê°€ì¥ í–‰ë³µí•œ ì•„ê¸°ëë‹ˆë‹¤. ì¢‹ì€ ê¿ˆ ê¿”ìš”, ìš°ë¦¬ ${name}! âœ¨`,
  (name: string) => `\n\në³„ë“¤ì´ ë°˜ì§ì´ëŠ” ë°¤, ${name}ëŠ” ë”°ëœ»í•œ ì‚¬ë‘ì— ê°ì‹¸ì—¬ ìƒˆê·¼ìƒˆê·¼ ì ì´ ë“¤ì—ˆì–´ìš”. ì‚¬ë‘í•´, ${name}! ğŸŒ™`,
  (name: string) => `\n\nì´ë ‡ê²Œ ${name}ì˜ ì†Œì¤‘í•œ í•˜ë£¨ê°€ ì§€ë‚˜ê°”ì–´ìš”. ë§¤ì¼ë§¤ì¼ì´ ê¸°ì  ê°™ì€ ìš°ë¦¬ ${name}ì˜ ì´ì•¼ê¸°ëŠ” ê³„ì†ë©ë‹ˆë‹¤. ğŸŒŸ`,
  (name: string) => `\n\nì˜¤ëŠ˜ë„ ${name}ëŠ” ì—„ë§ˆ ì•„ë¹ ì—ê²Œ ê°€ì¥ í° í–‰ë³µì„ ì„ ë¬¼í•´ì£¼ì—ˆë‹µë‹ˆë‹¤. ì‚¬ë‘í•´ìš”, ìš°ë¦¬ ì‘ì€ ì²œì‚¬ ${name}! ğŸ’•`,
];

// ë™í™” ìŠ¤íƒ€ì¼ë¡œ ë³€í™˜í•˜ëŠ” í•µì‹¬ í•¨ìˆ˜
const transformToStory = (name: string, userInput: string, phrContext: string): string => {
  // ë™í™” ì‹œì‘
  const beginning = storyBeginnings[Math.floor(Math.random() * storyBeginnings.length)](name);
  
  // ì‚¬ìš©ì ì…ë ¥ì„ ë™í™” ìŠ¤íƒ€ì¼ë¡œ ë³€í™˜
  let mainStory = userInput;
  
  // "ìš°ë¦¬ ì•„ê¸°", "ì•„ê¸°", "ì• ê¸°" ë“±ì„ ì´ë¦„ìœ¼ë¡œ ë³€í™˜
  mainStory = mainStory
    .replace(/ìš°ë¦¬\s*ì•„ê¸°|ìš°ë¦¬\s*ì• ê¸°/gi, `ìš°ë¦¬ ${name}`)
    .replace(/(\s|^)ì•„ê¸°(\s|,|\.|\!|\?|$)/gi, `$1${name}$2`)
    .replace(/(\s|^)ì• ê¸°(\s|,|\.|\!|\?|$)/gi, `$1${name}$2`);
  
  // ë™í™”ì²´ë¡œ ë¬¸ì¥ ë³€í™˜
  mainStory = mainStory
    .replace(/í–ˆì–´ìš”?\.|í–ˆì–´\.|í–ˆë‹¤\./gi, 'í–ˆë‹µë‹ˆë‹¤.')
    .replace(/í–ˆì–´ìš”?\!|í–ˆì–´\!/gi, 'í–ˆì–´ìš”!')
    .replace(/ë¨¹ì—ˆì–´ìš”?\.|ë¨¹ì—ˆì–´\./gi, 'ë¨¹ì—ˆë‹µë‹ˆë‹¤.')
    .replace(/ë†€ì•˜ì–´ìš”?\.|ë†€ì•˜ì–´\./gi, 'ë†€ì•˜ì–´ìš”.')
    .replace(/ì¤ì–´ìš”?\.|ì¤ì–´\./gi, 'ì¤ë‹µë‹ˆë‹¤.')
    .replace(/í–ˆë„¤ìš”?\.|í–ˆë„¤\./gi, 'í–ˆì–´ìš”.')
    .replace(/ì´ì—ìš”|ì˜ˆìš”/gi, 'ëë‹ˆë‹¤')
    .replace(/~|ã…‹|ã…/g, '');
  
  // PHR ê¸°ë¡ ê¸°ë°˜ ì„¸ë¶€ ë‚´ìš© ì¶”ê°€
  let phrStory = '';
  if (phrContext) {
    if (phrContext.includes('SLEEP')) {
      phrStory += ` í¬ê·¼í•œ ì´ë¶ˆ ì†ì—ì„œ ${name}ëŠ” ë‹¬ì½¤í•œ ê¿ˆë‚˜ë¼ë¡œ ë– ë‚¬ì–´ìš”.`;
    }
    if (phrContext.includes('FEED')) {
      phrStory += ` ë§›ìˆëŠ” ìš°ìœ ë¥¼ ë¨¹ê³  í˜ì´ ë¶ˆëˆ ì†Ÿì€ ${name}!`;
    }
    if (phrContext.includes('POOP')) {
      phrStory += ` ê¹¨ë—í•˜ê²Œ ì”»ê³  ìƒì¾Œí•´ì§„ ${name}ëŠ” ë”ìš± ê¸°ë¶„ì´ ì¢‹ì•„ì¡Œì–´ìš”.`;
    }
    if (phrContext.includes('BATH')) {
      phrStory += ` ëª©ìš• ì‹œê°„ì—ëŠ” ì²¨ë²™ì²¨ë²™ ë¬¼ë†€ì´ë¥¼ ì¦ê¸°ë©° ì‹ ë‚˜ê²Œ ë†€ì•˜ë‹µë‹ˆë‹¤.`;
    }
  }
  
  // ë™í™” ë§ˆë¬´ë¦¬
  const ending = storyEndings[Math.floor(Math.random() * storyEndings.length)](name);
  
  // ì „ì²´ ë™í™” ì¡°í•©
  return `${beginning}\n\n${mainStory}${phrStory}${ending}`;
};

export const generateDiaryEntry = async (
  childName: string, 
  userResponse: string, 
  phrSummary: string
): Promise<{ title: string; content: string }> => {
  // ìƒì„± ì¤‘ì¸ ëŠë‚Œì„ ì£¼ê¸° ìœ„í•œ ë”œë ˆì´
  await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 500));

  // ì œëª© ìƒì„±
  const title = generateStoryTitle(childName, userResponse, phrSummary);

  // ì‚¬ìš©ì ì…ë ¥ì´ ë„ˆë¬´ ì§§ìœ¼ë©´ ê¸°ë³¸ ë™í™” ì œê³µ
  if (!userResponse || userResponse.trim().length < 10) {
    const fallbackStories = [
      `ì˜¤ëŠ˜ ${childName}ëŠ” ì—„ë§ˆ ì•„ë¹ ì™€ í–‰ë³µí•œ í•˜ë£¨ë¥¼ ë³´ëƒˆì–´ìš”. ë”°ëœ»í•œ í–‡ì‚´ ì•„ë˜ì—ì„œ ë°©ê¸‹ë°©ê¸‹ ì›ƒìœ¼ë©°, ì‘ì€ ì†ì„ ê¼¼ì§€ë½ê±°ë¦¬ê³ , ê·€ì—¬ìš´ ì†Œë¦¬ë¡œ ì˜¹ì•Œì´ë¥¼ í–ˆë‹µë‹ˆë‹¤.\n\nì—„ë§ˆê°€ ì•ˆì•„ì£¼ë©´ ${childName}ëŠ” ì„¸ìƒì—ì„œ ê°€ì¥ ì•ˆì „í•˜ê³  í–‰ë³µí•œ ê¸°ë¶„ì´ ë“¤ì–´ìš”. ì•„ë¹ ì˜ ëª©ì†Œë¦¬ë¥¼ ë“¤ìœ¼ë©´ ê¹Œë¥´ë¥´ ì›ƒìŒì´ í„°ì ¸ ë‚˜ì˜¤ì£ .\n\nì˜¤ëŠ˜ë„ ${childName}ëŠ” ì‚¬ë‘ìœ¼ë¡œ ê°€ë“í•œ í•˜ë£¨ë¥¼ ë³´ëƒˆë‹µë‹ˆë‹¤. ìš°ë¦¬ì˜ ì‘ì€ ì²œì‚¬ ${childName}, ì–¸ì œë‚˜ ì‚¬ë‘í•´ìš”! ğŸ’•`,
      
      `ì‘ì€ ì™•ìë‹˜ ${childName}ì˜ íŠ¹ë³„í•œ í•˜ë£¨! ì˜¤ëŠ˜ ${childName}ëŠ” ë§ì€ ê²ƒë“¤ì„ ë°°ìš°ê³  ëŠê¼ˆì–´ìš”. ì—„ë§ˆì˜ ë”°ëœ»í•œ ì†ê¸¸, ì•„ë¹ ì˜ ë‹¤ì •í•œ ëª©ì†Œë¦¬, ì°½ë°–ìœ¼ë¡œ ë“¤ë ¤ì˜¤ëŠ” ìƒˆë“¤ì˜ ë…¸ë˜...\n\n${childName}ì˜ ëˆˆì— ë¹„ì¹œ ì„¸ìƒì€ ì°¸ ì‹ ê¸°í•˜ê³  ì•„ë¦„ë‹¤ì›Œìš”. ì‘ì€ ì†ê°€ë½ìœ¼ë¡œ ì„¸ìƒì„ íƒí—˜í•˜ê³ , í˜¸ê¸°ì‹¬ ê°€ë“í•œ ëˆˆìœ¼ë¡œ ì£¼ë³€ì„ ë°”ë¼ë³´ëŠ” ${childName}.\n\nê·¸ë ‡ê²Œ ${childName}ì˜ í•˜ë£¨ëŠ” ì‘ì€ ê¸°ì ë“¤ë¡œ ê°€ë“ ì±„ì›Œì¡Œë‹µë‹ˆë‹¤. ë‚´ì¼ì€ ë˜ ì–´ë–¤ ë©‹ì§„ ì¼ë“¤ì´ ê¸°ë‹¤ë¦¬ê³  ìˆì„ê¹Œìš”? ğŸŒŸ`,
    ];
    const content = fallbackStories[Math.floor(Math.random() * fallbackStories.length)];
    return { title, content };
  }
  
  // ì‚¬ìš©ì ì…ë ¥ì„ ë™í™”ë¡œ ë³€í™˜
  const content = transformToStory(childName, userResponse, phrSummary);
  return { title, content };
};
